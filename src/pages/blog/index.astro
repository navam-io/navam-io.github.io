---
import { getCollection } from 'astro:content';
import Layout from '@layouts/Layout.astro';
import Header from '@components/Header.vue';
import Footer from '@components/Footer.vue';
import BlogHero from '@components/BlogHero.vue';
import BlogList from '@components/BlogList.vue';

// Get all blog posts using content collections API
const allPosts = await getCollection('blog');

// Transform to format expected by BlogList component
const postArray = allPosts.map(post => {
  const data = post.data;
  return {
    url: `/blog/${post.slug}`,
    frontmatter: {
      title: data.title,
      // Use description or excerpt - BlogList expects 'excerpt'
      excerpt: data.excerpt || data.description || '',
      // Use pubDate or date
      pubDate: data.pubDate || data.date,
      // Use image or featuredImage - BlogList expects 'featuredImage'
      featuredImage: data.featuredImage || (data.image?.url) || '',
      author: data.author,
      tags: data.tags || [],
      featured: data.featured || false,
      readingTime: data.readingTime,
    }
  };
});

// Custom sorting function to prioritize featured posts and sort by date
const sortedPosts = postArray.sort((a, b) => {
  // Check if posts have featured status
  const aIsFeatured = a.frontmatter.featured || false;
  const bIsFeatured = b.frontmatter.featured || false;

  // Featured posts get priority
  if (aIsFeatured && !bIsFeatured) return -1;
  if (!aIsFeatured && bIsFeatured) return 1;

  // Within the same priority group, sort by date (newest first)
  const aDate = new Date(a.frontmatter.pubDate || 0);
  const bDate = new Date(b.frontmatter.pubDate || 0);
  return bDate - aDate;
});
---

<Layout
  title="Navam Blog - AI Product Studio Insights & Guides"
  description="AI product development insights, multi-agent systems, investment intelligence, and business intelligence guides from Navam's product studio."
  keywords="AI blog, product studio, AI insights, Navam Invest, Moments, AI business intelligence, investment intelligence guides, multi-agent systems, AI automation, AI product development"
  ogImage="/images/logo.png"
  ogType="website"
>
  <Header client:load />
  <main>
    <BlogHero client:load />
    <BlogList client:load posts={sortedPosts} />
  </main>
  <Footer client:load />
</Layout>
